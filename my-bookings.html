<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="/public/manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings - Healthify Lab</title>
    <link rel="stylesheet" href="/styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="/public/logo.png" alt="Healthify Lab Logo" class="logo">
            <nav>
                <a href="/index.html">Home</a>
                <a href="/booking.html">Book Test</a>
                <a href="/contact.html">Contact</a>
                <a href="/call-back.html" target="_blank">Call Me Back</a>
            </nav>
        </div>
        <main>
            <h1>üìã My Bookings</h1>
            <div id="bookingList"></div>
            <p id="noBookings" style="display: none;">No bookings found. <a href="/booking.html">Book a test now!</a></p>
        </main>
        <footer>
            <p>Healthifylive ¬© 2025 | Contact: +91 950383832889 | Email: <a href="mailto:report@healthifylab.com">report@healthifylab.com</a></p>
            <div class="social-media">
                <a href="https://x.com/healthify_lab" target="_blank"><i class="fab fa-x-twitter"></i></a>
                <a href="https://instagram.com/healthifylab" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://facebook.com/healthify" target="_blank"><i class="fab fa-facebook-f"></i></a>
            </div>
        </footer>
        <a href="https://wa.me/919503832889" class="whatsapp-float" target="_blank">
            <img src="/public/whatsapp-icon.png" alt="WhatsApp">
        </a>
    </div>
    <script src="/scripts/Drawer.js"></script>
    <script type="module">
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        const auth = getAuth();
        const db = getFirestore();

        onAuthStateChanged(auth, async (user) => {
            const bookingList = document.getElementById("bookingList");
            const noBookings = document.getElementById("noBookings");
            if (user) {
                try {
                    const q = query(collection(db, "bookings"), where("mobile", "==", user.phoneNumber || "+91" + user.email.split("@")[0].replace(/[^0-9]/g, "").slice(-10))); // Adjust based on your data structure
                    const querySnapshot = await getDocs(q);
                    if (!querySnapshot.empty) {
                        let html = "<ul>";
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            html += `<li>${data.date} at ${data.time} - ${data.tests ? data.tests.join(", ") : data.profiles ? data.profiles.join(", ") : "No tests"} <a href="/booking.html?edit=${doc.id}">Edit</a></li>`;
                        });
                        html += "</ul>";
                        bookingList.innerHTML = html;
                        noBookings.style.display = "none";
                    } else {
                        noBookings.style.display = "block";
                        bookingList.innerHTML = "";
                    }
                } catch (error) {
                    console.error("Error fetching bookings:", error);
                    bookingList.innerHTML = `<p class="error">‚ùå Failed to load bookings: ${error.message}</p>`;
                }
            } else {
                bookingList.innerHTML = "<p>Please <a href='#' onclick='document.getElementById(\"loginBtn\").click();'>log in</a> to view your bookings.</p>";
                noBookings.style.display = "none";
            }
        });
    </script>
    <script src="/scripts/pwa-register.js"></script>
</body>
</html>
